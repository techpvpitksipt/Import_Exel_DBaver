# Как подготовить Excel-файл и импортировать в DBeaver

Ниже — короткая, понятная инструкция “от А до Я” для твоего кейса (Excel → PostgreSQL → DBeaver).

---

## 1) Разделить один столбец на 2 колонки (Имя / Отчество)

**Ситуация:** в одной ячейке лежит строка вида: `Вероника Агафоновна`.

1. Выдели нужный столбец в Excel.
2. Перейди: **Данные (Data) → Текст по столбцам (Text to Columns)**
3. Выбери: **С разделителями (Delimited)** → **Далее**
4. Отметь разделитель: **Пробел (Space)**

   * Если бывают двойные пробелы — включи **Treat consecutive delimiters as one**
5. Нажми **Далее**
6. Выбери, куда вывести результат (например, в соседние столбцы) → **Готово**

**Результат:**

* Колонка 1: **Имя**
* Колонка 2: **Отчество**

---

## 2) Привести Excel к структуре таблицы в PostgreSQL (Users)

Чтобы импорт прошёл “без танцев”, в Excel сделай **точно такие колонки** (и в таком же порядке — это удобно):

**UserSurname | UserName | UserPatronymic | UserLogin | UserPassword | UserRole**

Если у тебя исходные названия такие:

* `ln` → `UserSurname`
* `fn` → `UserName`
* `mn` → `UserPatronymic`
* `login` → `UserLogin`
* `password` → `UserPassword`
* `role` → `UserRole`

⚠️ **UserID** в Excel **не добавляй** — он `serial`, PostgreSQL заполнит сам.

---

## 3) Сохранить файл из Excel “правильно” для DBeaver

### Вариант A (рекомендую): **CSV UTF-8**

1. **Файл (File) → Сохранить как (Save As)**
2. Тип файла: **CSV UTF-8 (Comma delimited) (*.csv)**
3. Сохрани, например: `Users.csv`

> Не пугайся, если разделитель получится `,` — в DBeaver его можно выбрать вручную.
> В некоторых локалях Excel сохраняет через `;` — это тоже нормально.

### Вариант B (если хочешь максимально надёжно): **TSV (табами)**

1. **Файл → Сохранить как**
2. Тип: **Text (Tab delimited) (*.txt)**
3. Сохрани как `Users.tsv` (или `Users.txt`)

> TSV часто проще, потому что в паролях могут быть спецсимволы — табы меньше конфликтуют.

---

## 4) Импорт в DBeaver (PostgreSQL) — пошагово

### 4.1. Важно: сначала проверь таблицу Role (из-за внешнего ключа)

У тебя `Users.UserRole` ссылается на `Role(RoleID)`.
Значит в `Role` **должны существовать** роли `1/2/3` (и т.д.).

Проверь:

```sql
SELECT * FROM Role ORDER BY RoleID;
```

Если ролей нет — добавь (минимально):

```sql
INSERT INTO Role (RoleID) VALUES (1), (2), (3);
```

---

### 4.2. Импорт Users

1. Открой в DBeaver таблицу **Users**
2. ПКМ по таблице → **Import Data**
3. Источник: **CSV** (или **Flat file**)
4. Выбери файл:

   * `Users.csv` (если CSV)
   * или `Users.tsv` / `Users.txt` (если TSV)

#### Настройки импорта

* **Encoding:** `UTF-8`
* **Delimiter:**

  * `;` если в файле разделитель точка с запятой
  * `,` если разделитель запятая
  * `Tab` если TSV
* **Header:** ✅ (первая строка — заголовки)
* **Quote char:** `"` (оставь по умолчанию)
* **Escape:** `"` или `\` (по умолчанию)

#### Mappings (сопоставление колонок)

Убедись, что DBeaver сопоставил поля так:

* `UserSurname`  ← `UserSurname`
* `UserName`     ← `UserName`
* `UserPatronymic` ← `UserPatronymic`
* `UserLogin`    ← `UserLogin`
* `UserPassword` ← `UserPassword`
* `UserRole`     ← `UserRole`

⚠️ `UserID` **не маппим / пропускаем** (serial заполнится сам).

5. Нажми **Finish** → импорт завершится.

---

## 5) Частые проблемы (и быстрые решения)

* **Кракозябры при импорте** → выбери **Encoding = UTF-8** (не “Default”)
* **Все значения попали в одну колонку** → неправильный **Delimiter** (`;` vs `,` vs Tab)
* **Ошибка foreign key по UserRole** → в `Role` нет нужных `RoleID` → сначала заполни `Role`
* **Пароли ломают CSV** (редко, но бывает) → сохраняй **TSV**, он устойчивее
